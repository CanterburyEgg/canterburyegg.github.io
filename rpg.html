<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RPG MVP - Refined</title>
    <style>
        body { background: #121212; color: #e0e0e0; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        #game-container { max-width: 950px; width: 100%; background: #1e1e1e; padding: 25px; border: 2px solid #d4af37; box-shadow: 0 0 20px #000; }
        .screen { display: none; }
        .active { display: block; }
        h1, h2 { color: #d4af37; text-align: center; text-transform: uppercase; letter-spacing: 2px; margin-top: 0; }
        #boss-intel { background: #300; border: 1px solid red; padding: 10px; margin-bottom: 15px; font-size: 0.85em; color: #ff9999; text-align: center; border-radius: 4px; }
        .p-box { background: #252525; padding: 15px; border-radius: 4px; width: 45%; border: 1px solid #444; }
        .class-option-card { background: #333; border: 1px solid gold; padding: 10px; margin-top: 10px; border-radius: 4px; text-align: left; cursor: pointer; }
        .class-option-card:hover { background: #444; }
        .class-option-card.selected { border: 3px solid #0f0; background: #2a3a2a; }
        #combat-log { height: 180px; background: #000; overflow-y: scroll; padding: 10px; margin: 20px 0; border-left: 4px solid #d4af37; color: #0f0; font-size: 0.9em; }
        .hp-bar-outer { height: 12px; background: #444; width: 100%; margin: 8px 0; border-radius: 2px; }
        .hp-bar-inner { height: 100%; background: #c0392b; transition: width 0.3s; border-radius: 2px; }
        .controls button { background: #d4af37; border: none; padding: 10px; font-weight: bold; cursor: pointer; font-family: inherit; margin-bottom: 5px; width: 100%; }
        .controls button:disabled { background: #444; color: #777; }
        
        /* Shared Talisman Screen */
        .talisman-layout { display: flex; justify-content: space-around; gap: 20px; margin-top: 20px; }
        .talisman-column { width: 45%; background: #252525; padding: 15px; border-radius: 8px; border: 1px solid #444; }
        .talisman-card { background: #333; border: 2px solid gold; padding: 10px; margin-top: 10px; cursor: pointer; border-radius: 6px; }
        .talisman-card.picked { border-color: #0f0; opacity: 0.6; pointer-events: none; }
        .talisman-card h4 { margin: 0; color: gold; }
        .talisman-card p { font-size: 0.8em; margin: 5px 0; }
        .talisman-list { font-size: 0.7em; color: #aaa; margin-top: 5px; font-style: italic; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="setup-screen" class="active">
        <h1>Hero Draft</h1>
        <div class="assignment-container" style="display:flex; justify-content: space-around; gap: 20px;">
            <div class="p-box" id="p0-setup"></div>
            <div class="p-box" id="p1-setup"></div>
        </div>
        <button onclick="initSetup()" style="background:#600; color:white; padding:15px; margin-top:20px; border:none; width:100%; cursor:pointer; font-weight:bold;">REROLL ALL HEROES</button>
        <button id="start-btn" style="background:green; color:white; padding:20px; margin-top:20px; display:none; border:none; width:100%; cursor:pointer; font-weight:bold;" onclick="startCombat()">ENTER DUNGEON</button>
    </div>

    <div id="combat-screen" class="screen">
        <div id="boss-intel">BOSS INTEL: ...</div>
        <div id="mind-gap-display" style="color:cyan; text-align:center; font-weight:bold; margin-bottom:10px;"></div>
        <h2 id="boss-name">BOSS</h2>
        <div id="boss-indicators" style="text-align:center; font-size:0.8em; color:red; margin-bottom:5px; height:1.2em;"></div>
        <div class="hp-bar-outer"><div id="boss-hp-fill" class="hp-bar-inner"></div></div>
        <div id="combat-log"></div>
        <div style="display:flex; justify-content:space-between; gap:20px;">
            <div id="card-0" class="p-box" style="width:100%"></div>
            <div id="card-1" class="p-box" style="width:100%"></div>
        </div>
        <button id="end-turn-btn" onclick="endTurn()" style="margin-top:20px; padding:15px; width:100%; background:gold; font-weight:bold; cursor:pointer; border:none;">END PLAYER TURN</button>
    </div>

    <div id="talisman-screen" class="screen">
        <h1>Victory! Pick Your Talismans</h1>
        <div class="talisman-layout">
            <div class="talisman-column" id="p0-talisman-col"></div>
            <div class="talisman-column" id="p1-talisman-col"></div>
        </div>
        <button id="continue-btn" style="background:green; color:white; padding:20px; margin-top:20px; display:none; border:none; width:100%; cursor:pointer; font-weight:bold;" onclick="nextFloor()">CONTINUE TO NEXT FLOOR</button>
    </div>
</div>

<script>
// Logic and Database (Same as previous, just showing changes)
const CLASS_DESC = { "Berserker": "Axe (STR/3-1). Hits add WOUNDS.", "Slayer": "Sword (STR/3+2). Pure Dmg.", "Bulwark": "Mace (STR/3). Passive: -2 dmg taken.", "Warden": "Halberd (STR/3). Boss forces Warden as target.", "Assassin": "Daggers (STR/6x2). Hits twice for 1 AP.", "Ranger": "Longbow (STR/3). Aim (2AP): x2 Dmg.", "Sorcerer": "Bolt (ARC/3). Great Bolt (3AP): 10 Dmg.", "Scholar": "Strike (STR/3). Heal (1AP): ARC/3 self.", "Gladiator": "Spear (STR/3). Momentum: +1 dmg when hit.", "Vanguard": "Greatsword (STR/3). Power Stance (2AP): +2 dmg.", "Dragoon": "Lance (STR/3). Counter 2 back hit.", "Monk": "Fists (STR/3). Focus (3AP): 10 Dmg hit.", "Duelist": "Rapier (STR/3). 1-in-6 chance DEX dmg.", "Samurai": "Katana (STR/3). Bleed: 6th hit +DEX.", "Paladin": "Mace (STR/3). Bless (2AP): +2 dmg/Lifesteal.", "Cleric": "Brand (2AP): Ally +1 dmg. Flash: Heal party 2.", "Spellblade": "Magic Dart (ARC/4). Echoing (3AP): Spells x3.", "Inquisitor": "Crossbow (STR/3). Silver Bolt (2AP): ARC dmg.", "Blood Knight": "Flail (STR/3). Infuse (2AP): +2 Dmg/-2 HP.", "Warlock": "Scythe (2AP): STR/3+3. Harvest: Heal if Ally low." };
const BOSSES = [ { name: "The Grunt", hp: 15, max: 15, intel: "1-3: 3 Dmg Both | 4-6: 5 Dmg One", logic: (r) => r <= 3 ? {d:3, t:'both'} : {d:5, t:'one'} }, { name: "The Bulwark", hp: 25, max: 25, intel: "1-5: 5 Dmg High HP | 6: 10 Dmg Rand", logic: (r) => r <= 5 ? {d:5, t:'most'} : {d:10, t:'rand'} }, { name: "The Hunter", hp: 35, max: 35, intel: "1-2: 4 Both | 3-4: 8 Rand | 5-6: 8 Low HP", logic: (r) => r <= 2 ? {d:4, t:'both'} : r <= 4 ? {d:8, t:'rand'} : {d:8, t:'low'} }, { name: "The Twin-Soul", hp: 50, max: 50, intel: "1-3: 3 Both, -1 AP | 4-5: 6 Rand, Heals | 6: 6 Rand, -2 AP", logic: (r) => r <= 3 ? {d:3, t:'both', ap:-1} : r <= 5 ? {d:6, t:'rand', h:true} : {d:6, t:'rand', ap:-2} } ];
const TALISMANS = { STR: [[{n:"Heavy Lead", d:"+2 Dmg on first attack.", id:"heavy_lead"}, {n:"Spiked Chain", d:"Attacks add +1 Wound.", id:"spiked_chain"}],[{n:"Adrenaline Clip", d:"+2 Max AP.", id:"adr_clip"}, {n:"Weight Stone", d:"Skip a move: x2 Dmg next turn.", id:"weight_stone"}],[{n:"Executioner Mark", d:"+10 Dmg vs low HP Boss.", id:"exec_mark"}, {n:"Titan Grip", d:"0 AP Attack if didn't move last turn.", id:"titan_grip"}]], DEX: [[{n:"Glass Needle", d:"+2 Dmg, -5 Max HP.", id:"glass_needle"}, {n:"Feather Charm", d:"+1 Armor every turn.", id:"feather_charm"}],[{n:"Twin-Strike Ribbon", d:"First attack hits twice.", id:"twin_ribbon"}, {n:"Duelist Cape", d:"20% Dodge chance.", id:"dodge_cape"}],[{n:"Perfect Lens", d:"Crits deal x3 Damage.", id:"lens"}, {n:"Shadow Box", d:"Shielding grants a free Attack.", id:"shadow_box"}]], CON: [[{n:"Rooted Boot", d:"Immune to AP-drain.", id:"boot"}, {n:"Thorn Plate", d:"Reflect 2 Dmg when hit.", id:"thorn_plate"}],[{n:"Blood Well", d:"+10 Max HP. Heal on AP spend.", id:"well"}, {n:"Iron Lung", d:"Shielding grants 5 Armor.", id:"lung"}],[{n:"Second Heart", d:"Once: Revive at 50% HP.", id:"heart"}, {n:"Juggernaut Seal", d:"Turn Armor into Dmg at turn end.", id:"juggernaut"}]], ARC: [[{n:"Mana Battery", d:"Start with 2 Spells.", id:"battery"}, {n:"Focusing Lens", d:"Ally deals +1 Damage.", id:"foc_lens"}],[{n:"Crystal Shard", d:"50% chance free spells.", id:"shard"}, {n:"Mind Gap", d:"See Boss Roll in advance.", id:"mind_gap"}],[{n:"Archmage Coil", d:"Big spells hit twice.", id:"coil"}, {n:"Spirit Link", d:"Take 50% of ally's damage.", id:"link"}]] };
const CLASS_MATRIX = { "STR": ["Berserker", "Slayer"], "CON": ["Bulwark", "Warden"], "DEX": ["Assassin", "Ranger"], "ARC": ["Sorcerer", "Scholar"], "CON,STR": ["Gladiator", "Vanguard"], "CON,DEX": ["Dragoon", "Monk"], "DEX,STR": ["Samurai", "Duelist"], "ARC,STR": ["Paladin", "Cleric"], "ARC,DEX": ["Spellblade", "Inquisitor"], "ARC,CON": ["Blood Knight", "Warlock"] };

let players = [], bossIdx = 0, wounds = 0, branded = false, nextBossRoll = 0, usedSecondHeart = [false, false], picksMade = 0;

function r2d6() { return (Math.floor(Math.random()*6)+1) + (Math.floor(Math.random()*6)+1); }
function createHero(idx) {
    let stats = {STR: r2d6(), DEX: r2d6(), CON: r2d6(), ARC: r2d6()};
    let s = Object.entries(stats).sort((a,b) => b[1] - a[1]);
    let key = (s[0][1] - s[1][1] <= 1) ? [s[0][0], s[1][0]].sort().join(',') : s[0][0];
    return {stats, mainStats: key.split(','), class: null, hp:0, maxHp:0, ap:0, baseAp:0, armor:0, spells:0, momentum:0, power:0, powerUsed:false, aim:false, infused:false, bleed:0, talismans:[], firstAtk:true, moved:true, pickedThisFloor: false};
}

function initSetup() { players = [createHero(0), createHero(1)]; renderSetup(); }
function selectClass(pIdx, cls) { players[pIdx].class = cls; renderSetup(); }
function renderSetup() {
    [0,1].forEach(i => {
        const p = players[i];
        let h = `<h3>Hero ${i+1}</h3><p>STR:${p.stats.STR} DEX:${p.stats.DEX} CON:${p.stats.CON} ARC:${p.stats.ARC}</p>`;
        const options = CLASS_MATRIX[p.mainStats.join(',')] || ["Slayer", "Berserker"];
        options.forEach(cls => h += `<div class="class-option-card ${p.class === cls ? 'selected' : ''}" onclick="selectClass(${i}, '${cls}')"><strong>${cls}</strong><br><small>${CLASS_DESC[cls]}</small></div>`);
        document.getElementById(`p${i}-setup`).innerHTML = h;
    });
    document.getElementById('start-btn').style.display = (players[0].class && players[1].class) ? 'block' : 'none';
}

function startCombat() {
    players.forEach(p => {
        p.maxHp = 20 + (p.stats.CON * 2); p.hp = p.maxHp;
        p.baseAp = 1 + Math.floor(p.stats.STR / 3); p.ap = p.baseAp;
    });
    document.getElementById('setup-screen').style.display = 'none';
    document.getElementById('combat-screen').classList.add('active');
    prepareTurn();
}

function prepareTurn() {
    const b = BOSSES[bossIdx];
    document.getElementById('boss-intel').innerText = `BOSS INTEL: ${b.intel}`;
    nextBossRoll = Math.floor(Math.random() * 6) + 1;
    let mindGap = players.some(p => p.talismans.some(t=>t.id==='mind_gap'));
    document.getElementById('mind-gap-display').innerText = mindGap ? `MIND GAP: Boss will roll a ${nextBossRoll}!` : "";
    update();
}

function update() {
    const b = BOSSES[bossIdx];
    document.getElementById('boss-name').innerText = `${b.name} (${b.hp}/${b.max})`;
    document.getElementById('boss-hp-fill').style.width = (b.hp/b.max*100) + "%";
    document.getElementById('boss-indicators').innerText = (wounds > 0 ? `[WOUNDS: ${wounds}] ` : "") + (branded ? "[BRANDED]" : "");
    players.forEach((p, i) => {
        document.getElementById(`card-${i}`).innerHTML = `<strong>${p.class}</strong><br>HP: ${p.hp}/${p.maxHp} | AP: ${p.ap}
            <div class="hp-bar-outer"><div class="hp-bar-inner" style="width:${(p.hp/p.maxHp*100)}%"></div></div>
            <div class="controls">${generateButtons(p, i)}</div>
            <div class="talisman-list">${p.talismans.map(t => t.n).join(', ')}</div>`;
    });
}

// Logic for Actions and End Turn (Same as previous, just showing checkStates fix)
function handleAction(i, type) {
    const p = players[i], b = BOSSES[bossIdx];
    let dmg = 0, cost = 1, heal = 0;
    let base = 1 + Math.floor(p.stats.STR / 3), arc = 1 + Math.floor(p.stats.ARC / 3);
    if (['power', 'infuse', 'aim', 'brand', 'flash', 'bless', 'silver'].includes(type)) cost = 2;
    if (['echo', 'great', 'focus'].includes(type)) cost = 3;
    if (type === 'atk' && p.talismans.some(t=>t.id==='titan_grip') && !p.moved) cost = 0;
    if (p.ap < cost) return;
    p.moved = true; p.ap -= cost;
    if(p.talismans.some(t=>t.id==='well')) p.hp = Math.min(p.maxHp, p.hp + 2);

    if (type === 'atk' || type === 'bolt' || type === 'great' || type === 'focus' || type === 'dart' || type === 'echo' || type === 'silver') {
        if (p.talismans.some(t=>t.id==='heavy_lead') && p.firstAtk) { dmg += 2; p.firstAtk = false; }
        if (p.talismans.some(t=>t.id==='spiked_chain')) wounds++;
        if (p.talismans.some(t=>t.id==='exec_mark') && b.hp < (b.max * 0.25)) dmg += 10;
        if (players.some(pl => pl.talismans.some(t=>t.id==='foc_lens')) && players.indexOf(p) !== players.findIndex(pl => pl.talismans.some(t=>t.id==='foc_lens'))) dmg += 1;
    }

    if (type === 'atk') {
        let hits = (p.talismans.some(t=>t.id==='twin_ribbon') && p.firstAtk) ? 2 : 1; p.firstAtk = false;
        for(let h=0; h<hits; h++) {
            if (p.class === 'Slayer') dmg += base + 2; else if (p.class === 'Berserker') { dmg += base - 1; wounds++; }
            else if (p.class === 'Assassin') dmg += Math.floor(p.stats.STR / 6) * 2; else if (p.class === 'Vanguard') dmg += base + p.power;
            else if (p.class === 'Samurai') { dmg += base; p.bleed++; if(p.bleed >= 6){ dmg += p.stats.DEX; p.bleed=0; } }
            else if (p.class === 'Duelist') { let crit = Math.random() < 0.16; let mult = (crit && p.talismans.some(t=>t.id==='lens')) ? 3 : 1; dmg += crit ? (p.stats.DEX * mult) : base; }
            else if (p.class === 'Blood Knight') { dmg += base + (p.infused ? 2 : 0); if(p.infused) p.hp -= 2; }
            else if (p.class === 'Gladiator') dmg += base + p.momentum; else dmg += base;
        }
    }
    if (type === 'bolt') dmg += arc; if (type === 'great' || type === 'focus') dmg += (p.talismans.some(t=>t.id==='coil') ? 20 : 10);
    if (type === 'dart') { dmg += Math.floor(p.stats.ARC / 4); p.spells += (p.talismans.some(t=>t.id==='shard') && Math.random() < 0.5) ? 0 : 1; p.spells++; }
    if (type === 'echo') { let mult = p.talismans.some(t=>t.id==='coil') ? 2 : 1; dmg += (p.spells * 3) * mult; p.spells = 0; }
    if (type === 'heal') heal = arc; if (type === 'aim') p.aim = true; if (type === 'power') { p.power = 2; p.powerUsed = true; }
    if (type === 'shd') { p.armor += (p.talismans.some(t=>t.id==='lung') ? 5 : 2); if(p.talismans.some(t=>t.id==='shadow_box')) { p.ap += 1; handleAction(i, 'atk'); } }
    if (type === 'infuse') p.infused = !p.infused;
    if (p.aim && dmg > 0) { dmg *= 2; p.aim = false; }
    if (dmg > 0) { b.hp -= (dmg + wounds + (branded ? 1 : 0)); log(`${p.class} deals ${dmg} dmg.`); }
    if (heal > 0) p.hp = Math.min(p.maxHp, p.hp + heal);
    checkStates(); update();
}

function generateButtons(p, i) {
    let b = `<button onclick="handleAction(${i}, 'atk')" ${p.ap < ((p.talismans.some(t=>t.id==='titan_grip') && !p.moved) ? 0 : 1) ? 'disabled':''}>Attack (${(p.talismans.some(t=>t.id==='titan_grip') && !p.moved) ? 0 : 1} AP)</button>`;
    if (p.class === 'Sorcerer') b = `<button onclick="handleAction(${i}, 'bolt')" ${p.ap < 1 ? 'disabled':''}>Bolt (1 AP)</button><button onclick="handleAction(${i}, 'great')" ${p.ap < 3 ? 'disabled':''}>Great Bolt (3 AP)</button>`;
    if (p.class === 'Scholar') b += `<button onclick="handleAction(${i}, 'heal')" ${p.ap < 1 ? 'disabled':''}>Heal (1 AP)</button>`;
    if (p.class === 'Ranger') b += `<button onclick="handleAction(${i}, 'aim')" ${p.ap < 2 ? 'disabled':''}>Aim (2 AP)</button>`;
    if (p.class === 'Vanguard') b += `<button onclick="handleAction(${i}, 'power')" ${(p.ap < 2 || p.powerUsed) ? 'disabled':''}>Stance (2 AP)</button>`;
    if (p.class === 'Spellblade') b = `<button onclick="handleAction(${i}, 'dart')" ${p.ap < 1 ? 'disabled':''}>Dart (1 AP)</button><button onclick="handleAction(${i}, 'echo')" ${p.ap < 3 ? 'disabled':''}>Echo (3 AP)</button>`;
    if (p.class === 'Blood Knight') b = `<button onclick="handleAction(${i}, 'infuse')" ${p.ap < 2 ? 'disabled':''}>${p.infused ? 'Uninfuse' : 'Infuse'} (2 AP)</button>` + b;
    if (p.class === 'Paladin') b += `<button onclick="handleAction(${i}, 'bless')" ${p.ap < 2 ? 'disabled':''}>Bless (2 AP)</button>`;
    if (p.class === 'Cleric') b = `<button onclick="handleAction(${i}, 'brand')" ${p.ap < 2 ? 'disabled':''}>Brand (2 AP)</button><button onclick="handleAction(${i}, 'flash')" ${p.ap < 2 ? 'disabled':''}>Flash Heal (2 AP)</button>` + b;
    if (p.class === 'Monk') b += `<button onclick="handleAction(${i}, 'focus')" ${p.ap < 3 ? 'disabled':''}>Focus (3 AP)</button>`;
    if (p.class === 'Inquisitor') b += `<button onclick="handleAction(${i}, 'silver')" ${p.ap < 2 ? 'disabled':''}>Silver Bolt (2 AP)</button>`;
    return b + `<button onclick="handleAction(${i}, 'shd')" ${p.ap < 1 ? 'disabled':''}>Shield (1 AP)</button>`;
}

function endTurn() {
    const b = BOSSES[bossIdx];
    let act = b.logic(nextBossRoll); log(`[BOSS] ${b.name} rolls ${nextBossRoll}`);
    let targetIdx = (act.t === 'most') ? (players[0].hp >= players[1].hp ? 0 : 1) : (act.t === 'low') ? (players[0].hp <= players[1].hp ? 0 : 1) : Math.floor(Math.random()*2);
    players.forEach((p, i) => {
        if (p.talismans.some(t=>t.id==='feather_charm')) p.armor += 1;
        let hit = (act.t === 'both' || i === targetIdx) ? act.d : 0;
        if ((players[0].class === 'Warden' || players[1].class === 'Warden') && act.t !== 'both') { hit = (p.class === 'Warden') ? act.d : 0; }
        if (hit > 0 && p.talismans.some(t=>t.id==='dodge_cape') && Math.random() < 0.2) { log(`${p.class} dodged!`); hit = 0; }
        let final = Math.max(0, hit - (p.class === 'Bulwark' ? 2 : 0) - p.armor);
        if (final > 0 && players.some(pl => pl.talismans.some(t=>t.id==='link')) && !p.talismans.some(t=>t.id==='link')) {
            let linker = players.find(pl => pl.talismans.some(t=>t.id==='link')); linker.hp -= Math.floor(final/2); final = Math.ceil(final/2);
        }
        if (final > 0 && p.talismans.some(t=>t.id==='thorn_plate')) b.hp -= 2;
        p.hp -= final; if (p.talismans.some(t=>t.id==='juggernaut')) b.hp -= p.armor;
        if (p.hp <= 0 && p.talismans.some(t=>t.id==='heart') && !usedSecondHeart[i]) { p.hp = Math.floor(p.maxHp / 2); usedSecondHeart[i] = true; log(`${p.class} Second Heart Proc!`); }
        p.ap = Math.max(0, p.baseAp + ((p.talismans.some(t=>t.id==='boot')) ? 0 : (act.ap || 0)));
        p.armor = 0; p.firstAtk = true; p.moved = false;
    });
    checkStates(); if(bossIdx < 4 && BOSSES[bossIdx].hp > 0) prepareTurn();
}

function checkStates() {
    if (players.some(p => p.hp <= 0)) { alert("GAME OVER"); location.reload(); }
    if (BOSSES[bossIdx].hp <= 0) {
        if (bossIdx >= 3) { alert("YOU CONQUERED THE DUNGEON!"); location.reload(); }
        else { showSharedTalismanScreen(); }
    }
}

function showSharedTalismanScreen() {
    document.getElementById('combat-screen').style.display = 'none';
    document.getElementById('talisman-screen').classList.add('active');
    document.getElementById('continue-btn').style.display = 'none';
    picksMade = 0;

    [0,1].forEach(i => {
        const p = players[i];
        p.pickedThisFloor = false;
        const col = document.getElementById(`p${i}-talisman-col`);
        col.innerHTML = `<h3>${p.class}</h3>`;
        let tier = bossIdx;
        let pool = (p.mainStats.length === 1) ? TALISMANS[p.mainStats[0]][tier] : 
                   [TALISMANS[p.mainStats[0]][tier][Math.floor(Math.random()*2)], TALISMANS[p.mainStats[1]][tier][Math.floor(Math.random()*2)]];
        
        pool.forEach(t => {
            const card = document.createElement('div');
            card.className = 'talisman-card';
            card.innerHTML = `<h4>${t.n}</h4><p>${t.d}</p>`;
            card.onclick = () => {
                p.talismans.push(t);
                if(t.id==='glass_needle') { p.maxHp -= 5; p.hp = Math.min(p.hp, p.maxHp); }
                if(t.id==='adr_clip') p.baseAp += 2;
                if(t.id==='battery') p.spells += 2;
                card.classList.add('picked');
                p.pickedThisFloor = true;
                picksMade++;
                if(picksMade >= 2) document.getElementById('continue-btn').style.display = 'block';
            };
            col.appendChild(card);
        });
    });
}

function nextFloor() {
    document.getElementById('talisman-screen').classList.remove('active');
    document.getElementById('combat-screen').style.display = 'block';
    bossIdx++;
    players.forEach(p => { p.hp = Math.min(p.maxHp, p.hp+5); p.ap = p.baseAp; wounds=0; });
    prepareTurn();
}

function log(m) { const c = document.getElementById('combat-log'); c.innerHTML += `> ${m}<br>`; c.scrollTop = c.scrollHeight; }
initSetup();
</script>
</body>
</html>